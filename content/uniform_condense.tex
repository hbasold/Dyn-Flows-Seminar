\section{Gleichförmig reduzierte zeit-expandierte Netzwerke}\label{sec:unif_cond}

TODO: Definiere Fluss auf Pfaden!

\subsection{Quickest Transshipment mit einer Ware (singlecommodity)}

Zu QTP:
\begin{theorem}\label{theo:qtp_flow_ex}
    Sei $T \geq T^*$. Setze $\Delta := \frac{\eps^2 T}{n}$ und
    $T' := \lceil (1+\eps)^3 T / \Delta \rceil \Delta$.
    Dann gilt:
    \begin{enumerate}[label={\alph*)}]
        \item in $\redNetw{T'}{\Delta}$ existiert ein statischer Fluss $x$ mit
            Bedarf $|x| = (1 + \eps)D$ und Kosten $c(x) \leq (1+\eps)C$.
        \item aus $x$ kann ein dynamischer Fluss $f$ in $\graph$ berechnet werden,
            der bei $(1+\eps)T'$ endet und für den $|f| = D$ und $c(f) \leq C$
            gilt.
    \end{enumerate}
\end{theorem}

Also erfüllt das damit konstruierte Netzwerk $(\graph, \tau')$ die Eigenschaften
\ref{a1} und \ref{a2}. Aus dem Satz lässt sich auch sofort der Algorithmus
zur Bestimmung eines solchen Flusses folgern. Dies wollen wir noch tun,
bevor wir den Satz beweisen.

\begin{algorithm}
\caption{QTP-FPTAS-Core}
\label{alg:qtp_core}
\begin{algorithmic}[1]
    \REQUIRE $\graph, u, c, \tau, D, C, T, \eps > 0$
    \ENSURE Entweder zulässiger Fluss $f$ mit $f(t) = 0$, $t > (1+\eps) T'$
        und $|f| = D$ und $c(f) \leq C$ oder nichts. Das bedeutet, dass
        $T < T^*$.
    \STATE $\Delta, T$ wie in \theoRef{qtp_flow_ex}.
    \STATE Versuche Fluss $x$ in $\redNetw{T'}{\Delta}$ wie in \theoRef{qtp_flow_ex}
        zu berechnen. Wenn dieser nicht existiert: Ende.
    \STATE Berechne aus $x$ einen Fluss $f$ in $\graph$.
\end{algorithmic}
\end{algorithm}

TODO: Einbettung in Suchframework

\begin{lemma}\label{lem:flow_avg}
    Sei $\func{f}{\A \times \ropen{0, T + \delta}}{\R_+}$ ein dynamischer Fluss in
    $(\graph, \tau)$ mit einer endlichen Pfadzerlegung $\pathSet$.
    Sei $\eps > 0$ gegeben. Setze
    \[
    \bar{f}(P)(t) := \frac{1}{\eps T}
                            \int_{t - \eps T}^{t} f(P)(\theta) \; d\theta \text{ .}
    \]
    Dann endet $\bar{f}$ bei $\delta + T + \eps T$,
    d.h. $\func{\bar{f}}{\ropen{0, \delta + (1+\eps)T}}{\R+}$, ist zulässig und hat Wert
    $|\bar{f}| = |f|$ und Kosten $c(\bar{f}) = c(f)$.

    $\bar{f}$ ist der \term{Mittelwert} von $f$.

    \begin{proof}
        Im Wesentlichen Bildung des Mittels von $f$. Siehe Anhang.
    \end{proof}
\end{lemma}

\begin{theorem}\label{theo:slow_flow}
    Sei $\func{f}{\A \times \ropen{0, T + \delta}}{\R_+}$ ein dynamischer Fluss in
    $(\graph, \tau)$ mit $|f| = D$ und $c(f) \leq C$ und einer endlichen
    Pfadzerlegung $\pathSet$. Sei $\eps > 0$ und $(\graph, \tau')$ das
    gleiche Netzwerk mit geänderten Zeiten, für die
    $\left|\tau(e) - \tau'(e)\right| \leq \frac{\eps^2T}{n}$ gilt. Definiere
    einen Fluss in $(\graph, \tau')$
    \[
    \tilde{f}(P)(t) := \frac{1}{1+\eps} \frac{1}{\eps T}
                            \int_{t - \eps T}^{t} f(P)(\theta) \; d\theta \text{ .}
    \]
    Dann ist $\tilde{f}$ zulässig und es gilt:
    \begin{enumerate}
        \item $\tilde{f}$ endet bei $\delta + T + \eps T + \eps^2 T$
        \item $\tilde{f}$ verläuft nur auf Pfaden aus $\pathSet$
        \item $|\tilde{f}| = \frac{D}{1 + \eps}$
        \item $c(\tilde{f}) \leq \frac{C}{1 + \eps}$
    \end{enumerate}
\end{theorem}

\begin{lemma}\label{lem:relaxed_flow}
    Sei $\func{f^*(e)}{\ropen{0,T^*}}{\R_+}$ ein dynamischer Fluss in $(\graph, \tau)$
    mit Bedarf $|f^*| = D$ und Kosten $c(f^*) \leq C$. Für alle $\delta \geq 1$ und
    und $T \geq T^*$ existiert ein dynamischer Fluss
    $\func{f(e)}{\ropen{0, \delta T}}{\R_+}$ mit $|f| = \delta D$ und
    $c(f) \leq \delta C$. Dabei ist $f$ kreisfrei/kommt ohne Speicher aus, wenn $f^*$
    dies ist/tut.
\end{lemma}

Zu QTP:
\begin{theorem}\label{theo:qtp_opt_flow}
    TODO: Existenz optimaler Fluss mit Pfadzerlegung und ohne Speicher
     (Corollary 4.5).
\end{theorem}

\begin{standaloneProof}[\theoRef{qtp_flow_ex}a]
    Nach \theoRef{qtp_opt_flow} existiert ein optimaler Fluss $f^*$, der
    keinen Speicher benötigt und nur auf Pfaden verläuft.
    Setze $\delta = (1 + \eps)^2$ und wende \lemRef{relaxed_flow} mit
    $T \geq T^*$ an und erhalte einen Fluss $f$ der bei $(1 + \eps)^2 T$ endet.
    $f$ besitzt damit eine endliche Pfadzerlegung, hat Bedarf
    $|f| = (1 + \eps)^2 D$ und Kosten $c(f) \leq (1 + \eps)^2 C$.
    
    Setze nun $\tau'(e) := \lceil \tau(e) / \Delta \rceil \Delta$ für
    alle $e \in \A$. Dann ist offensichtlich
    $|\tau(e) - \tau'(e)| \leq \Delta = \frac{\eps^2 T}{n}$.
    Da $\delta T = T + 2 \eps T + \eps^2 T$ ist, liefert
    \theoRef{slow_flow} uns einen Fluss $\tilde{f}$ in $(\graph, \tau')$
    der bei
    \begin{align*}
        & T + 2 \eps T + \eps^2 T + \eps T + \eps^2 T \\
        & = T + 3 \eps T + 2 \eps^2 T \\
        & \leq T + 3 \eps T + 3 \eps^2 T + \eps^3 T \\
        & = (1 + \eps)^3 T \leq T'
    \end{align*}
    endet. $\tilde{f}$ hat Bedarf
    $|\tilde{f}| = \frac{|f|}{1+\eps} = (1 + \eps) D$ und ebenso
    Kosten $c(\tilde{f}) \leq (1 + \eps) C$.
    
    Da $\tau'$ und $T'$ nach Konstruktion ganzzahlig durch
    $\Delta$ teilbar sind, lässt sich $\tilde{f}$ als statischer Fluss $x$ in
    $\redNetw{T'}{\Delta}$ interpretieren, der die gewünschten
    Eigenschaften hat.
    
    \begin{flushright}\qed \end{flushright}
\end{standaloneProof}

\begin{lemma}\label{lem:path_decomp}
    Eine Pfadzerlegung $\pathSet$ von einem statischen Fluss $x$ in
    $\redNetw{T'}{\Delta}$ kann in eine Pfadzerlegung $\pathSet'$ des
    zugehörigen dynamischen Flusses $f'$ in $(\graph, \tau')$ 
    transformiert werden. Dabei wird $\ropen{0, T'}$ in $T'/\Delta$
    disjunkte Teilintervalle zerlegt, auf den $f'(P)$ auf allen $P \in \pathSet'$
    konstant ist.
\end{lemma}

\begin{standaloneProof}[\theoRef{qtp_flow_ex}b]
    Der Fluss $x$ in $\redNetw{T'}{\Delta}$ induziert einen Fluss $f'$ in
    $(\graph, \tau')$:
    \begin{align*}
        & \func{f'(e)}{\ropen{0,T'}}{\R_+} \\
        & f'(e)(t) = x(e_{\lfloor t \rfloor}) \\
        & \quad \text{ (d.h. } f'(e)(\theta) = x(e_t)
            \text{ für alle } \theta \in \ropen{t, t+1} \text{ ) }
    \end{align*}
    \lemRef{static_dyn_conv} liefert, dass $f'$ ein zulässiger Fluss in
    $(\graph, \tau')$ ist und die gleichen Eigenschaften wie $x$
    (Bedarf $(1+\eps)D$, Kosten $(1+\eps)C$) hat.
    
    Mit \lemRef{path_decomp} bekommen wir eine Pfadzerlegung $\pathSet'$.
    $f = \frac{1}{1+\eps} \bar{f}$ aus \lemRef{flow_avg} liefert uns, dass
    $f$ auf $\ropen{0, (1 + \eps)T'}$ definiert ist und Bedarf $D$ und Kosten
    $c(f) \leq C$ hat.
    \begin{flushright}\qed \end{flushright}
\end{standaloneProof}

TODO: Laufzeitanalyse

\begin{remark}
    Alles was wir für den Beweis von \theoRef{qtp_flow_ex} benutzt haben, ist
    unabhängig von einem speziellen Flussproblem gültig
    (bis auf \theoRef{qtp_opt_flow}). Dies liefert uns also ein „Framework“
    zur Konstruktion von Algorithmen und entsprechenden Beweisen.
\end{remark}

\subsection*{Quickest Transshipment mit mehren Waren (multicommodity)}
Dies wollen wir direkt ausnutzen, um ein das obige Verfahren auf mehrere
Waren zu verallgemeinern. Die Approximation hiervon ohne Speicher ist allerdings
NP-hart (TODO: Quelle [19] dazu betrachten), da eine optimale Lösung ohne Speicher
Zyklen enthalten kann. Mit Speicher kann allerdings einfach gewartet werden,
anstatt einen Zyklus zu benutzen.

Allerdings kann aus einem Pfad, auf dem Speicher verwendet wird, nicht mehr wie
in dem Beweis von \theoRef{slow_flow} der Fluss auf Kanten rekonstruiert werden.
Das kommt daher, dass dort erwartet wird, das sich die Laufzeit eines Flusses
direkt aus $\tau$ ergibt. Mit Speicher ist dies aber nicht der Fall
(s. dazu Definition von $\tau(P \downarrow e)$).

TODO: definiere $P^\delta$ und $\tau(P^\delta \downarrow e)$, lasse dabei $\delta$
eine Funktion $V \to \R_+$ sein.

TODO: verallgemeinere \theoRef{slow_flow}, um Speicher mit dieser Definition zuzulassen
und setze in den Beweisen im letzten Abschnitt $\delta = 0$

Dann folgt dies alles als Korollar.

